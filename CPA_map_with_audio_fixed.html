<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KLVK CPA Â±60s Animated (v1769851488)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
 integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
 integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
  html, body { height: 100%; margin: 0; }
  #map { height: 100%; }
  .panel {
    position: absolute;
    left: 12px;
    top: 12px;
    background: rgba(0,0,0,0.75);
    color: #fff;
    padding: 10px 12px;
    border-radius: 12px;
    font: 13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    z-index: 9999;
    min-width: 285px;
  }
  .row { margin: 4px 0; }
  .small { opacity: 0.85; font-size: 12px; }
  .btn {
    cursor: pointer;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(255,255,255,0.10);
    color: white;
    padding: 6px 10px;
    border-radius: 10px;
    margin-right: 8px;
    user-select: none;
    display: inline-block;
  }
  .btn:hover { background: rgba(255,255,255,0.18); }
  input[type="range"] { width: 265px; }
  .tag { display:inline-block; padding:2px 8px; border-radius:999px; background:rgba(255,255,255,0.12); }

  .callout {
    background: rgba(0,0,0,0.78);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 10px;
    padding: 6px 8px;
    font: 12px/1.25 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    box-shadow: 0 8px 22px rgba(0,0,0,0.35);
    white-space: nowrap;
  }
</style>
</head>
<body>
<div id="map"></div>
<audio id="audioPlayer" preload="auto">
  <source src="data:audio/mpeg;base64,YOUR_BASE64_AUDIO_HERE" type="audio/mpeg">
  Your browser does not support audio playback.
</audio>
<div class="panel" id="panel">
  <div class="row"><span class="tag">Window</span> CPA Â±60s</div>
  <div class="row small">CPA time: <span id="cpaTime">2026-01-26T21:38:48+00:00</span></div>
  <div class="row"><span class="btn" id="playBtn">Play</span><span class="btn" id="pauseBtn">Pause</span><span class="btn" id="stepBtn">Step</span><span class="btn" id="muteBtn">ðŸ”Š Mute</span></div>
  <div class="row small">Playback speed: <span id="spdLbl">1.00Ã—</span></div>
  <div class="row">
    <input id="speed" type="range" min="0.25" max="6" step="0.25" value="1.0">
  </div>
  <div class="row small">Time: <span id="tLbl">â€”</span></div>
  <div class="row small">3D sep: <span id="sepLbl">â€”</span></div>
  <div class="row">
    <input id="scrub" type="range" min="0" max="120" step="1" value="0">
  </div>
  <div class="row small">Frame: <span id="fLbl">0</span> / 120</div>
</div>

<script>
console.log("=== RV Callout: BOTTOM-LEFT anchor at (50, -65) ===");
console.log("Animation timing: 120 frames at 1000ms per frame = 120 seconds at 1x speed");
const frames = [{"t": "2026-01-26T21:37:48+00:00", "rv": {"lat": 37.70429166666667, "lon": -121.83490666666668, "alt": 1087.5, "spd": 76.16666666666667, "trk": 269.0, "vs": null}, "wd": {"lat": 37.69372369142159, "lon": -121.86774829133896, "alt": 609.6230687283289, "spd": 72.94549189193626, "trk": 81.39098409308646, "vs": null}, "sep3d_ft": 10244.938079749669, "sep_h_ft": 10233.786684139122, "sep_v_ft": 477.8769312716711}, {"t": "2026-01-26T21:37:49+00:00", "rv": {"lat": 37.704283333333336, "lon": -121.83534333333331, "alt": 1075.0, "spd": 76.33333333333333, "trk": 269.0, "vs": -750.0}, "wd": {"lat": 37.69377296581303, "lon": -121.8673238414858, "alt": 600.8193101941603, "spd": 72.70457303777752, "trk": 81.72157010609459, "vs": -528.225512050119}, "sep3d_ft": 10007.132600729055, "sep_h_ft": 9995.891934289282, "sep_v_ft": 474.1806898058397}, {"t": "2026-01-26T21:37:50+00:00", "rv": {"lat": 37.704275, "lon": -121.83578, "alt": 1062.5, "spd": 76.5, "trk": 269.0, "vs": -750.0}, "wd": {"lat": 37.6938142771809, "lon": -121.86691544421356, "alt": 592.3620428770154, "spd": 72.38910547645166, "trk": 82.64357748048246, "vs": -507.4360390286938}, "sep3d_ft": 9775.287468976094, "sep_h_ft": 9763.9753892763, "sep_v_ft": 470.13795712298463}, {"t": "2026-01-26T21:37:51+00:00", "rv": {"lat": 37.70426666666667, "lon": -121.83621666666669, "alt": 1050.0, "spd": 76.66666666666667, "trk": 269.0, "vs": -750.0}, "wd": {"lat": 37.69384931875152, "lon": -121.86649596798448, "alt": 583.8335177576306, "spd": 72.08852410750653, "trk": 83.95164082866272, "vs": -511.711507163086}, "sep3d_ft": 9542.066035552836, "sep_h_ft": 9530.672223809022, "sep_v_ft": 466.1664822423694}, {"t": "2026-01-26T21:37:52+00:00", "rv": {"lat": 37.704258333333335, "lon": -121.83665333333332, "alt": 1037.5, "spd": 76.83333333333333, "trk": 269.0, "vs": -750.0}, "wd": {"lat": 37.69388271691157, "lon": -121.86606704226968, "alt": 575.2207130145791, "spd": 71.77967906278677, "trk": 85.34144353284735, "vs": -516.7682845830882}, "sep3d_ft": 9307.350668621351, "sep_h_ft": 9295.863291244692, "sep_v_ft": 462.27928698542087}, {"t": "2026-01-26T21:37:53+00:00", "rv": {"lat": 37.70425, "lon": -121.83709, "alt": 1025.0, "spd": 77.0, "trk": 269.0, "vs": -750.0}, "wd": {"lat": 37.69390414788551, "lon": -121.8656486713963, "alt": 567.0864619416012, "spd": 71.54982931500113, "trk": 86.60102320009989, "vs": -488.05506437867507}, "sep3d_ft": 9078.02901058596, "sep_h_ft": 9066.472627692818, "sep_v_ft": 457.9135380583988}, {"t": "2026-01-26T21:37:54+00:00", "rv": {"lat": 37.70425, "lon": -121.83756, "alt": 1025.0, "spd": 77.5, "trk": 268.0, "vs": 0.0}, "wd": {"lat": 37.69391861060768, "lon": -121.86523018725224, "alt": 558.2613865569095, "spd": 71.35057632181244, "trk": 87.34827058088295, "vs": -529.5045230815003}, "sep3d_ft": 8844.004798539838, "sep_h_ft": 8831.680244625984, "sep_v_ft": 466.73861344309046}, {"t": "2026-01-26T21:37:55+00:00", "rv": {"lat": 37.70425, "lon": -121.83803, "alt": 1025.0, "spd": 78.0, "trk": 267.0, "vs": 0.0}, "wd": {"lat": 37.69393213643008, "lon": -121.86482114217976, "alt": 549.6531788436506, "spd": 71.29999984888062, "trk": 87.57368119570981, "vs": -516.4924627955361}, "sep3d_ft": 8613.854589241415, "sep_h_ft": 8600.728822850535, "sep_v_ft": 475.3468211563494}, {"t": "2026-01-26T21:37:56+00:00", "rv": {"lat": 37.704245, "lon": -121.838625, "alt": 1012.5, "spd": 78.5, "trk": 268.0, "vs": -750.0}, "wd": {"lat": 37.69394336871881, "lon": -121.8643973226262, "alt": 540.798727166685, "spd": 71.15077407441214, "trk": 87.6, "vs": -531.2671006179357}, "sep3d_ft": 8347.962698460946, "sep_h_ft": 8334.625313959998, "sep_v_ft": 471.701272833315}, {"t": "2026-01-26T21:37:57+00:00", "rv": {"lat": 37.70424, "lon": -121.83922, "alt": 1000.0, "spd": 79.0, "trk": 269.0, "vs": -750.0}, "wd": {"lat": 37.69395630158024, "lon": -121.86397990789874, "alt": 532.0992313373691, "spd": 71.02437853068133, "trk": 87.52437868121655, "vs": -521.9697497589527}, "sep3d_ft": 8085.367114746246, "sep_h_ft": 8071.817035271858, "sep_v_ft": 467.90076866263087}, {"t": "2026-01-26T21:37:58+00:00", "rv": {"lat": 37.70422333333333, "lon": -121.83951666666668, "alt": 991.6666666666666, "spd": 79.33333333333333, "trk": 269.3333333333333, "vs": -500.0000000000023}, "wd": {"lat": 37.693969976477, "lon": -121.86356984443964, "alt": 522.0741166419284, "spd": 70.99999984951646, "trk": 87.34863692202875, "vs": -601.5068817264432}, "sep3d_ft": 7900.473016708451, "sep_h_ft": 7886.504721655823, "sep_v_ft": 469.5925500247382}, {"t": "2026-01-26T21:37:59+00:00", "rv": {"lat": 37.70420666666666, "lon": -121.83981333333332, "alt": 983.3333333333334, "spd": 79.66666666666667, "trk": 269.6666666666667, "vs": -499.99999999999545}, "wd": {"lat": 37.69398350047635, "lon": -121.86315373192554, "alt": 512.1658040251792, "spd": 71.1494573780747, "trk": 87.22527123556249, "vs": -594.4987570049511}, "sep3d_ft": 7715.052706971312, "sep_h_ft": 7700.651883488243, "sep_v_ft": 471.1675293081541}, {"t": "2026-01-26T21:38:00+00:00", "rv": {"lat": 37.70419, "lon": -121.84011, "alt": 975.0, "spd": 80.0, "trk": 270.0, "vs": -500.0000000000023}, "wd": {"lat": 37.69399976020637, "lon": -121.86273940918905, "alt": 503.2819851658096, "spd": 71.12501327534915, "trk": 87.42495972170704, "vs": -533.0291315621776}, "sep3d_ft": 7530.595622802199, "sep_h_ft": 7515.806846150886, "sep_v_ft": 471.7180148341904}, {"t": "2026-01-26T21:38:01+00:00", "rv": {"lat": 37.70419, "lon": -121.840555, "alt": 962.5, "spd": 80.0, "trk": 268.5, "vs": -750.0}, "wd": {"lat": 37.694011375977325, "lon": -121.86234285939676, "alt": 495.4985127518629, "spd": 70.88474318560674, "trk": 87.78700888553868, "vs": -467.0083448368018}, "sep3d_ft": 7318.435827926278, "sep_h_ft": 7303.52056055044, "sep_v_ft": 467.0014872481371}, {"t": "2026-01-26T21:38:02+00:00", "rv": {"lat": 37.70419, "lon": -121.841, "alt": 950.0, "spd": 80.0, "trk": 267.0, "vs": -750.0}, "wd": {"lat": 37.694021881041614, "lon": -121.86192266119428, "alt": 487.66866321829, "spd": 70.7257132652689, "trk": 88.19714633931567, "vs": -469.790972014373}, "sep3d_ft": 7102.660325479239, "sep_h_ft": 7087.597155183587, "sep_v_ft": 462.3313367817101}, {"t": "2026-01-26T21:38:03+00:00", "rv": {"lat": 37.70419, "lon": -121.84148, "alt": 937.5, "spd": 80.0, "trk": 267.0, "vs": -750.0}, "wd": {"lat": 37.69403219333561, "lon": -121.86151035388184, "alt": 479.8311550266779, "spd": 70.55021118814743, "trk": 88.3, "vs": -470.2504914967278}, "sep3d_ft": 6882.649222763922, "sep_h_ft": 6867.41578411804, "sep_v_ft": 457.6688449733221}, {"t": "2026-01-26T21:38:04+00:00", "rv": {"lat": 37.70419, "lon": -121.84196, "alt": 925.0, "spd": 80.0, "trk": 267.0, "vs": -750.0}, "wd": {"lat": 37.69404228423257, "lon": -121.86110691071444, "alt": 471.8387379881916, "spd": 70.4266577442837, "trk": 88.3, "vs": -479.54502230917683}, "sep3d_ft": 6667.511113246656, "sep_h_ft": 6652.093603962555, "sep_v_ft": 453.1612620118085}, {"t": "2026-01-26T21:38:05+00:00", "rv": {"lat": 37.70417, "lon": -121.84244, "alt": 925.0, "spd": 79.5, "trk": 267.0, "vs": 0.0}, "wd": {"lat": 37.69404983033401, "lon": -121.86070826992731, "alt": 464.0919044434782, "spd": 70.47061599753965, "trk": 88.44123229380232, "vs": -464.81001268280465}, "sep3d_ft": 6453.633579167746, "sep_h_ft": 6437.153882082667, "sep_v_ft": 460.9080955565218}, {"t": "2026-01-26T21:38:06+00:00", "rv": {"lat": 37.70415, "lon": -121.84292, "alt": 925.0, "spd": 79.0, "trk": 267.0, "vs": 0.0}, "wd": {"lat": 37.69405666061637, "lon": -121.86028869973792, "alt": 456.44753009273256, "spd": 70.49999985057622, "trk": 88.64128633284652, "vs": -458.66246104473817}, "sep3d_ft": 6238.048685152059, "sep_h_ft": 6220.426832723871, "sep_v_ft": 468.5524699072674}, {"t": "2026-01-26T21:38:07+00:00", "rv": {"lat": 37.70411, "lon": -121.843515, "alt": 912.5, "spd": 79.0, "trk": 264.5, "vs": -750.0}, "wd": {"lat": 37.694062323055626, "lon": -121.85987200301408, "alt": 448.7316663088861, "spd": 70.49999985057622, "trk": 88.87836043713313, "vs": -462.9518270307892}, "sep3d_ft": 5995.290674501062, "sep_h_ft": 5977.32625882382, "sep_v_ft": 463.7683336911139}, {"t": "2026-01-26T21:38:08+00:00", "rv": {"lat": 37.70407, "lon": -121.84411, "alt": 900.0, "spd": 79.0, "trk": 262.0, "vs": -750.0}, "wd": {"lat": 37.69406746973062, "lon": -121.85946045312316, "alt": 440.9890850151602, "spd": 70.49999985057622, "trk": 89.1294177539765, "vs": -464.55487762355347}, "sep3d_ft": 5758.427701446742, "sep_h_ft": 5740.104404339174, "sep_v_ft": 459.01091498483976}, {"t": "2026-01-26T21:38:09+00:00", "rv": {"lat": 37.70397, "lon": -121.844615, "alt": 887.5, "spd": 80.0, "trk": 258.5, "vs": -750.0}, "wd": {"lat": 37.69407141761763, "lon": -121.85904477618186, "alt": 433.2888222154531, "spd": 70.49999985057622, "trk": 89.27319856472738, "vs": -462.01576798242627}, "sep3d_ft": 5531.3060160818295, "sep_h_ft": 5512.625368145255, "sep_v_ft": 454.2111777845469}, {"t": "2026-01-26T21:38:10+00:00", "rv": {"lat": 37.70387, "lon": -121.84512, "alt": 875.0, "spd": 81.0, "trk": 255.0, "vs": -750.0}, "wd": {"lat": 37.69407489666898, "lon": -121.85862748518667, "alt": 425.6051098143279, "spd": 70.49999985057622, "trk": 89.37502445776491, "vs": -461.02274406751235}, "sep3d_ft": 5307.8192811883655, "sep_h_ft": 5288.760701187944, "sep_v_ft": 449.3948901856721}, {"t": "2026-01-26T21:38:11+00:00", "rv": {"lat": 37.70377666666667, "lon": -121.84542, "alt": 866.6666666666666, "spd": 81.0, "trk": 249.66666666666663, "vs": -500.0000000000023}, "wd": {"lat": 37.6940783313783, "lon": -121.85821550645063, "alt": 417.0278265769912, "spd": 70.65110492131765, "trk": 89.4, "vs": -514.6369942402021}, "sep3d_ft": 5134.37232205779, "sep_h_ft": 5114.646034184176, "sep_v_ft": 449.6388400896754}, {"t": "2026-01-26T21:38:12+00:00", "rv": {"lat": 37.70368333333333, "lon": -121.84572, "alt": 858.3333333333334, "spd": 81.0, "trk": 244.33333333333331, "vs": -499.99999999999545}, "wd": {"lat": 37.69408172405628, "lon": -121.85780857961404, "alt": 408.7228979916084, "spd": 70.69999985015232, "trk": 89.4748504276863, "vs": -498.29571512296525}, "sep3d_ft": 4964.636064265627, "sep_h_ft": 4944.235199405336, "sep_v_ft": 449.61043534172495}, {"t": "2026-01-26T21:38:13+00:00", "rv": {"lat": 37.70359, "lon": -121.84602, "alt": 850.0, "spd": 81.0, "trk": 239.0, "vs": -500.0000000000023}, "wd": {"lat": 37.69408506709323, "lon": -121.85740613837136, "alt": 400.9079977552397, "spd": 70.55389632677841, "trk": 89.64610352368358, "vs": -468.8940141821229}, "sep3d_ft": 4798.687608643031, "sep_h_ft": 4777.626935923729, "sep_v_ft": 449.0920022447603}, {"t": "2026-01-26T21:38:14+00:00", "rv": {"lat": 37.703335, "lon": -121.84647, "alt": 837.5, "spd": 80.5, "trk": 233.5, "vs": -750.0}, "wd": {"lat": 37.69408598333333, "lon": -121.8570069593764, "alt": 393.23836899650695, "spd": 70.35908775671949, "trk": 89.77045604707769, "vs": -460.17772552396536}, "sep3d_ft": 4564.342433915054, "sep_h_ft": 4542.670300303085, "sep_v_ft": 444.26163100349305}, {"t": "2026-01-26T21:38:15+00:00", "rv": {"lat": 37.70308, "lon": -121.84692, "alt": 825.0, "spd": 80.0, "trk": 228.0, "vs": -750.0}, "wd": {"lat": 37.69408841022419, "lon": -121.85659479257292, "alt": 385.55212632806473, "spd": 70.15793794737027, "trk": 89.40932976418993, "vs": -461.17456010653314}, "sep3d_ft": 4330.37197985047, "sep_h_ft": 4308.016602823078, "sep_v_ft": 439.44787367193527}, {"t": "2026-01-26T21:38:16+00:00", "rv": {"lat": 37.70282, "lon": -121.84721, "alt": 825.0, "spd": 80.5, "trk": 222.5, "vs": 0.0}, "wd": {"lat": 37.69409189673624, "lon": -121.85617660671222, "alt": 377.8519364815344, "spd": 69.9538494377835, "trk": 88.84808636163675, "vs": -462.011390791821}, "sep3d_ft": 4127.665884168971, "sep_h_ft": 4103.374740457433, "sep_v_ft": 447.1480635184656}, {"t": "2026-01-26T21:38:17+00:00", "rv": {"lat": 37.70256, "lon": -121.8475, "alt": 825.0, "spd": 81.0, "trk": 217.0, "vs": 0.0}, "wd": {"lat": 37.694100284343655, "lon": -121.85576769315529, "alt": 370.3225923193184, "spd": 69.68143369651918, "trk": 88.11715691788812, "vs": -451.76064973295865}, "sep3d_ft": 3927.705308003454, "sep_h_ft": 3901.299455497269, "sep_v_ft": 454.67740768068165}, {"t": "2026-01-26T21:38:18+00:00", "rv": {"lat": 37.702215, "lon": -121.847775, "alt": 812.5, "spd": 81.0, "trk": 211.5, "vs": -750.0}, "wd": {"lat": 37.69411330923006, "lon": -121.8553595530617, "alt": 362.8648199199081, "spd": 69.37516309544957, "trk": 87.45032648497858, "vs": -447.466343964619}, "sep3d_ft": 3705.5204040168255, "sep_h_ft": 3678.139430394037, "sep_v_ft": 449.6351800800919}, {"t": "2026-01-26T21:38:19+00:00", "rv": {"lat": 37.70187, "lon": -121.84805, "alt": 800.0, "spd": 81.0, "trk": 206.0, "vs": -750.0}, "wd": {"lat": 37.69412938378711, "lon": -121.85495652850793, "alt": 355.7062908236265, "spd": 69.15175234825574, "trk": 87.15175249482195, "vs": -429.51174577689585}, "sep3d_ft": 3485.134177199699, "sep_h_ft": 3456.698328328888, "sep_v_ft": 444.2937091763735}, {"t": "2026-01-26T21:38:20+00:00", "rv": {"lat": 37.70145, "lon": -121.84829, "alt": 775.0, "spd": 81.5, "trk": 204.0, "vs": -1500.0}, "wd": {"lat": 37.69414371251817, "lon": -121.85456315327896, "alt": 347.1756647543615, "spd": 69.0274692328804, "trk": 87.39012248326722, "vs": -511.8375641558998}, "sep3d_ft": 3250.614274118592, "sep_h_ft": 3222.3375827611803, "sep_v_ft": 427.8243352456385}, {"t": "2026-01-26T21:38:21+00:00", "rv": {"lat": 37.70103, "lon": -121.84853, "alt": 750.0, "spd": 82.0, "trk": 202.0, "vs": -1500.0}, "wd": {"lat": 37.694157111640784, "lon": -121.85416477213218, "alt": 337.9294114779218, "spd": 68.92934070281798, "trk": 87.9239549065233, "vs": -554.7751965863813}, "sep3d_ft": 3016.954203101745, "sep_h_ft": 2988.680393365666, "sep_v_ft": 412.0705885220782}, {"t": "2026-01-26T21:38:22+00:00", "rv": {"lat": 37.700765, "lon": -121.848655, "alt": 750.0, "spd": 83.5, "trk": 200.5, "vs": 0.0}, "wd": {"lat": 37.69416705890849, "lon": -121.8537689408536, "alt": 329.3176621294385, "spd": 68.86521599947352, "trk": 88.23913541827035, "vs": -516.7049609089997}, "sep3d_ft": 2854.7849587052365, "sep_h_ft": 2823.618871422525, "sep_v_ft": 420.6823378705615}, {"t": "2026-01-26T21:38:23+00:00", "rv": {"lat": 37.7005, "lon": -121.84878, "alt": 750.0, "spd": 85.0, "trk": 199.0, "vs": 0.0}, "wd": {"lat": 37.69417554250447, "lon": -121.8533754840872, "alt": 321.00839777696655, "spd": 68.81555592556636, "trk": 88.43777571432004, "vs": -498.55586114831567}, "sep3d_ft": 2695.751569389887, "sep_h_ft": 2661.398641521062, "sep_v_ft": 428.9916022230335}, {"t": "2026-01-26T21:38:24+00:00", "rv": {"lat": 37.70004, "lon": -121.848955, "alt": 725.0, "spd": 85.0, "trk": 194.5, "vs": -1500.0}, "wd": {"lat": 37.69418300260524, "lon": -121.85296900847418, "alt": 313.3326620211092, "spd": 68.65943579848036, "trk": 88.74598709799457, "vs": -460.54414535144247}, "sep3d_ft": 2465.265329076318, "sep_h_ft": 2430.650765862332, "sep_v_ft": 411.6673379788908}, {"t": "2026-01-26T21:38:25+00:00", "rv": {"lat": 37.69958, "lon": -121.84913, "alt": 700.0, "spd": 85.0, "trk": 190.0, "vs": -1500.0}, "wd": {"lat": 37.69418999585277, "lon": -121.85255659449344, "alt": 305.9459016155448, "spd": 68.45475538331273, "trk": 89.10417782529711, "vs": -443.2056243338616}, "sep3d_ft": 2236.1002106740666, "sep_h_ft": 2201.105522169035, "sep_v_ft": 394.0540983844552}, {"t": "2026-01-26T21:38:26+00:00", "rv": {"lat": 37.69925666666666, "lon": -121.84918666666668, "alt": 691.6666666666666, "spd": 84.33333333333333, "trk": 188.66666666666663, "vs": -500.0000000000023}, "wd": {"lat": 37.694194375423045, "lon": -121.85215395965504, "alt": 300.096485442258, "spd": 68.10485204635278, "trk": 89.9378695232498, "vs": -350.96497039721044}, "sep3d_ft": 2073.070020801492, "sep_h_ft": 2035.7534488050808, "sep_v_ft": 391.5701812244087}, {"t": "2026-01-26T21:38:27+00:00", "rv": {"lat": 37.698933333333336, "lon": -121.84924333333332, "alt": 683.3333333333334, "spd": 83.66666666666667, "trk": 187.33333333333331, "vs": -499.99999999999545}, "wd": {"lat": 37.6941927380886, "lon": -121.8517555001376, "alt": 295.30453017853904, "spd": 67.55378019900017, "trk": 90.57184971485044, "vs": -287.51731582313596}, "sep3d_ft": 1915.035174273317, "sep_h_ft": 1875.3115385520057, "sep_v_ft": 388.02880315479433}, {"t": "2026-01-26T21:38:28+00:00", "rv": {"lat": 37.69861, "lon": -121.8493, "alt": 675.0, "spd": 83.0, "trk": 186.0, "vs": -500.0000000000023}, "wd": {"lat": 37.69418936298644, "lon": -121.85137367661189, "alt": 289.7998293224316, "spd": 67.18016452052542, "trk": 90.91983533708712, "vs": -330.282051366446}, "sep3d_ft": 1762.812769426125, "sep_h_ft": 1720.2121056898118, "sep_v_ft": 385.2001706775684}, {"t": "2026-01-26T21:38:29+00:00", "rv": {"lat": 37.698145, "lon": -121.8493, "alt": 662.5, "spd": 82.5, "trk": 182.5, "vs": -750.0}, "wd": {"lat": 37.69418343952021, "lon": -121.85098099326638, "alt": 284.13218633134693, "spd": 66.73337938614615, "trk": 91.14664818896534, "vs": -340.0585794650806}, "sep3d_ft": 1570.7655892922414, "sep_h_ft": 1524.5138025233507, "sep_v_ft": 378.367813668653}, {"t": "2026-01-26T21:38:30+00:00", "rv": {"lat": 37.69768, "lon": -121.8493, "alt": 650.0, "spd": 82.0, "trk": 179.0, "vs": -750.0}, "wd": {"lat": 37.69417656105738, "lon": -121.85059233818522, "alt": 277.5469978762817, "spd": 66.45203080703114, "trk": 91.12601547393766, "vs": -395.11130730391415}, "sep3d_ft": 1382.543493146893, "sep_h_ft": 1331.429784724618, "sep_v_ft": 372.4530021237183}, {"t": "2026-01-26T21:38:31+00:00", "rv": {"lat": 37.69735, "lon": -121.849275, "alt": 637.5, "spd": 81.0, "trk": 172.5, "vs": -750.0}, "wd": {"lat": 37.69416966409123, "lon": -121.85019605463684, "alt": 270.10150270272936, "spd": 66.62474707307777, "trk": 91.1, "vs": -446.72971041313986}, "sep3d_ft": 1245.712129499989, "sep_h_ft": 1190.301244965788, "sep_v_ft": 367.3984972972706}, {"t": "2026-01-26T21:38:32+00:00", "rv": {"lat": 37.69702, "lon": -121.84925, "alt": 625.0, "spd": 80.0, "trk": 166.0, "vs": -750.0}, "wd": {"lat": 37.69416274752711, "lon": -121.84980547174098, "alt": 264.2121391269381, "spd": 66.77613360810071, "trk": 91.02386625036816, "vs": -353.3618145474759}, "sep3d_ft": 1114.6288214328308, "sep_h_ft": 1054.6229321493922, "sep_v_ft": 360.7878608730619}, {"t": "2026-01-26T21:38:33+00:00", "rv": {"lat": 37.696675, "lon": -121.849075, "alt": 612.5, "spd": 79.0, "trk": 158.0, "vs": -750.0}, "wd": {"lat": 37.69415857800926, "lon": -121.84941839241247, "alt": 259.03982182403723, "spd": 66.87466625251214, "trk": 90.92533360574792, "vs": -310.3390381740519}, "sep3d_ft": 988.6991153196732, "sep_h_ft": 923.3590001065246, "sep_v_ft": 353.4601781759628}, {"t": "2026-01-26T21:38:34+00:00", "rv": {"lat": 37.69633, "lon": -121.8489, "alt": 600.0, "spd": 78.0, "trk": 150.0, "vs": -750.0}, "wd": {"lat": 37.694155133240905, "lon": -121.8490288282708, "alt": 253.7408156780024, "spd": 66.89999985820637, "trk": 90.67316261599784, "vs": -317.94036876208963}, "sep3d_ft": 866.4827262270503, "sep_h_ft": 794.2901813081453, "sep_v_ft": 346.2591843219976}, {"t": "2026-01-26T21:38:35+00:00", "rv": {"lat": 37.696, "lon": -121.848625, "alt": 575.0, "spd": 76.5, "trk": 144.0, "vs": -1500.0}, "wd": {"lat": 37.69415177357352, "lon": -121.84864262009252, "alt": 250.27723849325625, "spd": 66.82605566866803, "trk": 90.52605581030495, "vs": -207.81463108476942}, "sep3d_ft": 748.3933873508794, "sep_h_ft": 674.2757524855523, "sep_v_ft": 324.7227615067438}, {"t": "2026-01-26T21:38:36+00:00", "rv": {"lat": 37.69567, "lon": -121.84835, "alt": 550.0, "spd": 75.0, "trk": 138.0, "vs": -1500.0}, "wd": {"lat": 37.694148322600725, "lon": -121.8482527228628, "alt": 247.294834512967, "spd": 66.65010331641432, "trk": 90.42505172883916, "vs": -178.94423881735577}, "sep3d_ft": 632.9180751805955, "sep_h_ft": 555.8370918513606, "sep_v_ft": 302.705165487033}, {"t": "2026-01-26T21:38:37+00:00", "rv": {"lat": 37.69544, "lon": -121.84802, "alt": 537.5, "spd": 74.0, "trk": 131.0, "vs": -750.0}, "wd": {"lat": 37.69414490500832, "lon": -121.84785988508747, "alt": 244.09529639013928, "spd": 67.04985205406003, "trk": 90.32502463397144, "vs": -191.97228736966224}, "sep3d_ft": 558.0751275194655, "sep_h_ft": 474.7225798879567, "sep_v_ft": 293.4047036098607}, {"t": "2026-01-26T21:38:38+00:00", "rv": {"lat": 37.69521, "lon": -121.84769, "alt": 525.0, "spd": 73.0, "trk": 124.0, "vs": -750.0}, "wd": {"lat": 37.69414405, "lon": -121.84746820198012, "alt": 240.8514504611451, "spd": 68.01232554523598, "trk": 90.15230442011142, "vs": -194.63075573965057}, "sep3d_ft": 485.8614098111332, "sep_h_ft": 394.1077407748125, "sep_v_ft": 284.1485495388549}, {"t": "2026-01-26T21:38:39+00:00", "rv": {"lat": 37.694995000000006, "lon": -121.84724, "alt": 512.5, "spd": 71.5, "trk": 121.0, "vs": -750.0}, "wd": {"lat": 37.69414165484447, "lon": -121.84708689047817, "alt": 239.07346308000592, "spd": 68.65051042101385, "trk": 90.1, "vs": -106.67924286835103}, "sep3d_ft": 416.6895719153949, "sep_h_ft": 314.43302665428484, "sep_v_ft": 273.4265369199941}, {"t": "2026-01-26T21:38:40+00:00", "rv": {"lat": 37.69478, "lon": -121.84679, "alt": 500.0, "spd": 70.0, "trk": 118.0, "vs": -750.0}, "wd": {"lat": 37.69414063333333, "lon": -121.84667068982868, "alt": 237.48917526450947, "spd": 69.38127885995127, "trk": 90.31797962762649, "vs": -95.05726892978714}, "sep3d_ft": 352.85022694747465, "sep_h_ft": 235.77817870527576, "sep_v_ft": 262.51082473549053}, {"t": "2026-01-26T21:38:41+00:00", "rv": {"lat": 37.69472, "lon": -121.84657666666666, "alt": 500.0, "spd": 69.0, "trk": 114.66666666666669, "vs": 0.0}, "wd": {"lat": 37.69413814370103, "lon": -121.846260027713, "alt": 237.04068241469804, "spd": 70.11007086093313, "trk": 90.10853085169688, "vs": -26.9095709886858}, "sep3d_ft": 350.08611659519016, "sep_h_ft": 231.11184809042868, "sep_v_ft": 262.959317585302}, {"t": "2026-01-26T21:38:42+00:00", "rv": {"lat": 37.69466, "lon": -121.84636333333331, "alt": 500.0, "spd": 68.0, "trk": 111.33333333333331, "vs": 0.0}, "wd": {"lat": 37.69413721666667, "lon": -121.8458467998402, "alt": 238.2496663513396, "spd": 70.52109883286451, "trk": 89.92630033922234, "vs": 72.53903619849439}, "sep3d_ft": 356.53857197668583, "sep_h_ft": 242.08782733130005, "sep_v_ft": 261.7503336486604}, {"t": "2026-01-26T21:38:43+00:00", "rv": {"lat": 37.6946, "lon": -121.84615, "alt": 500.0, "spd": 67.0, "trk": 108.0, "vs": 0.0}, "wd": {"lat": 37.69413981828763, "lon": -121.84542696175042, "alt": 241.4291175897967, "spd": 70.67614485396379, "trk": 89.59541998495632, "vs": 190.76707430742545}, "sep3d_ft": 372.2990259088659, "sep_h_ft": 267.85754322456404, "sep_v_ft": 258.5708824102033}, {"t": "2026-01-26T21:38:44+00:00", "rv": {"lat": 37.694505, "lon": -121.845715, "alt": 487.5, "spd": 65.5, "trk": 105.5, "vs": -750.0}, "wd": {"lat": 37.69414576959175, "lon": -121.84502117482428, "alt": 245.7424757324621, "spd": 70.77516460736831, "trk": 88.59802291149613, "vs": 258.80148855992445}, "sep3d_ft": 340.20011441922856, "sep_h_ft": 239.3520781419853, "sep_v_ft": 241.7575242675379}, {"t": "2026-01-26T21:38:45+00:00", "rv": {"lat": 37.69441, "lon": -121.84528, "alt": 475.0, "spd": 64.0, "trk": 103.0, "vs": -750.0}, "wd": {"lat": 37.69415758200738, "lon": -121.84461570511247, "alt": 250.77323150606253, "spd": 70.6517897298735, "trk": 87.48484433790455, "vs": 301.8453464160251}, "sep3d_ft": 309.07958363445096, "sep_h_ft": 212.7264565361152, "sep_v_ft": 224.22676849393747}, {"t": "2026-01-26T21:38:46+00:00", "rv": {"lat": 37.694345, "lon": -121.844815, "alt": 462.5, "spd": 63.5, "trk": 100.0, "vs": -750.0}, "wd": {"lat": 37.69417519560769, "lon": -121.84420241382, "alt": 256.80490232993264, "spd": 70.41261376784516, "trk": 87.050091133667, "vs": 361.9002494322069}, "sep3d_ft": 278.2422616654835, "sep_h_ft": 187.3720442628111, "sep_v_ft": 205.69509767006736}, {"t": "2026-01-26T21:38:47+00:00", "rv": {"lat": 37.69428, "lon": -121.84435, "alt": 450.0, "spd": 63.0, "trk": 97.0, "vs": -750.0}, "wd": {"lat": 37.69419424195246, "lon": -121.84378686719334, "alt": 263.12578332785904, "spd": 70.15911317257088, "trk": 86.84729065701774, "vs": 379.2528598755837}, "sep3d_ft": 249.6528178215148, "sep_h_ft": 165.54321668191707, "sep_v_ft": 186.87421667214096}, {"t": "2026-01-26T21:38:48+00:00", "rv": {"lat": 37.694255, "lon": -121.844025, "alt": 437.5, "spd": 62.5, "trk": 95.0, "vs": -750.0}, "wd": {"lat": 37.69421064908894, "lon": -121.8434029169451, "alt": 265.05934020639745, "spd": 70.73039087718293, "trk": 87.010130342365, "vs": 116.01341271230467}, "sep3d_ft": 249.49060416080573, "sep_h_ft": 180.3046877218418, "sep_v_ft": 172.44065979360255}, {"t": "2026-01-26T21:38:49+00:00", "rv": {"lat": 37.69423, "lon": -121.8437, "alt": 425.0, "spd": 62.0, "trk": 93.0, "vs": -750.0}, "wd": {"lat": 37.69422530473814, "lon": -121.84298460936566, "alt": 264.56898851451126, "spd": 71.55832598373816, "trk": 87.58853536847943, "vs": -29.42110151317138}, "sep3d_ft": 261.51183788526225, "sep_h_ft": 206.5195678570693, "sep_v_ft": 160.43101148548874}, {"t": "2026-01-26T21:38:50+00:00", "rv": {"lat": 37.694205, "lon": -121.84331, "alt": 412.5, "spd": 62.0, "trk": 93.0, "vs": -750.0}, "wd": {"lat": 37.69423643141998, "lon": -121.84257642933892, "alt": 259.3357130782445, "spd": 72.14192590476684, "trk": 88.48385211534136, "vs": -313.9965261760051}, "sep3d_ft": 261.5975973261711, "sep_h_ft": 212.07075267130952, "sep_v_ft": 153.1642869217555}, {"t": "2026-01-26T21:38:51+00:00", "rv": {"lat": 37.69418, "lon": -121.84292, "alt": 400.0, "spd": 62.0, "trk": 93.0, "vs": -750.0}, "wd": {"lat": 37.69424210364819, "lon": -121.84213507568364, "alt": 252.60761324189292, "spd": 73.15591530844448, "trk": 89.4419365976231, "vs": -403.68599018109535}, "sep3d_ft": 271.2536097124695, "sep_h_ft": 227.714745038158, "sep_v_ft": 147.39238675810705}, {"t": "2026-01-26T21:38:52+00:00", "rv": {"lat": 37.69416666666667, "lon": -121.84262, "alt": 391.6666666666667, "spd": 61.66666666666666, "trk": 92.33333333333331, "vs": -499.99999999999886}, "wd": {"lat": 37.69424308333333, "lon": -121.84170128116106, "alt": 247.7135266056817, "spd": 73.79135894839658, "trk": 90.3555579857918, "vs": -293.64519817267364}, "sep3d_ft": 303.0423832390438, "sep_h_ft": 266.66866989915013, "sep_v_ft": 143.95314006098502}, {"t": "2026-01-26T21:38:53+00:00", "rv": {"lat": 37.69415333333333, "lon": -121.84232, "alt": 383.3333333333333, "spd": 61.333333333333336, "trk": 91.66666666666669, "vs": -500.0000000000023}, "wd": {"lat": 37.694238033460266, "lon": -121.84126282815436, "alt": 244.73447799796293, "spd": 74.23295850639674, "trk": 91.00694947789526, "vs": -178.742916463126}, "sep3d_ft": 336.5949286065116, "sep_h_ft": 306.735233162654, "sep_v_ft": 138.59885533537036}, {"t": "2026-01-26T21:38:54+00:00", "rv": {"lat": 37.69414, "lon": -121.84202, "alt": 375.0, "spd": 61.0, "trk": 91.0, "vs": -499.99999999999886}, "wd": {"lat": 37.69423109570408, "lon": -121.840818472918, "alt": 242.23319587900835, "spd": 74.69039297934162, "trk": 91.566036057124, "vs": -150.07692713727465}, "sep3d_ft": 372.8721940471616, "sep_h_ft": 348.4345689179568, "sep_v_ft": 132.76680412099165}, {"t": "2026-01-26T21:38:55+00:00", "rv": {"lat": 37.69414, "lon": -121.84169, "alt": 375.0, "spd": 59.5, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.69421917020928, "lon": -121.8403837302224, "alt": 239.6628338675754, "spd": 75.25057601837965, "trk": 91.85019205929076, "vs": -154.22172068597774}, "sep3d_ft": 401.6732725008212, "sep_h_ft": 378.186817994445, "sep_v_ft": 135.3371661324246}, {"t": "2026-01-26T21:38:56+00:00", "rv": {"lat": 37.69414, "lon": -121.84136, "alt": 375.0, "spd": 58.0, "trk": 89.0, "vs": 0.0}, "wd": {"lat": 37.694207935424494, "lon": -121.839940886472, "alt": 236.75321107610984, "spd": 75.93481637772514, "trk": 91.82359763733317, "vs": -174.5773674879331}, "sep3d_ft": 433.0650488660267, "sep_h_ft": 410.4060938894152, "sep_v_ft": 138.24678892389016}, {"t": "2026-01-26T21:38:57+00:00", "rv": {"lat": 37.69414, "lon": -121.84092, "alt": 362.5, "spd": 57.5, "trk": 89.0, "vs": -750.0}, "wd": {"lat": 37.69419773156983, "lon": -121.8394953536354, "alt": 232.8170008666677, "spd": 76.9354736441852, "trk": 91.26833484993251, "vs": -236.1726125665274}, "sep3d_ft": 431.7306370492619, "sep_h_ft": 411.79322809238334, "sep_v_ft": 129.68299913333226}, {"t": "2026-01-26T21:38:58+00:00", "rv": {"lat": 37.69414, "lon": -121.84048, "alt": 350.0, "spd": 57.0, "trk": 89.0, "vs": -750.0}, "wd": {"lat": 37.69419019895097, "lon": -121.8390518116769, "alt": 226.18146521144664, "spd": 78.24080207980941, "trk": 90.65394189472582, "vs": -398.1321393132646}, "sep3d_ft": 430.8579084701022, "sep_h_ft": 412.68330198112784, "sep_v_ft": 123.81853478855336}, {"t": "2026-01-26T21:38:59+00:00", "rv": {"lat": 37.69416, "lon": -121.84016, "alt": 350.0, "spd": 56.5, "trk": 89.0, "vs": 0.0}, "wd": {"lat": 37.6941858594017, "lon": -121.83858399291314, "alt": 217.77761771522603, "spd": 79.50986850243332, "trk": 90.27253283226165, "vs": -504.2308497732364}, "sep3d_ft": 473.8662212723184, "sep_h_ft": 455.0455332006291, "sep_v_ft": 132.22238228477397}, {"t": "2026-01-26T21:39:00+00:00", "rv": {"lat": 37.69418, "lon": -121.83984, "alt": 350.0, "spd": 56.0, "trk": 89.0, "vs": 0.0}, "wd": {"lat": 37.69418503333333, "lon": -121.83811201644475, "alt": 208.80440012951237, "spd": 80.702750760605, "trk": 90.0495415113911, "vs": -538.3930551428193}, "sep3d_ft": 518.4205343722421, "sep_h_ft": 498.822265978589, "sep_v_ft": 141.19559987048763}, {"t": "2026-01-26T21:39:01+00:00", "rv": {"lat": 37.69418, "lon": -121.83946, "alt": 350.0, "spd": 55.5, "trk": 89.5, "vs": 0.0}, "wd": {"lat": 37.69418503333333, "lon": -121.83764144971222, "alt": 200.24637865660907, "spd": 81.81015142814759, "trk": 90.66285131035345, "vs": -513.4812883741984}, "sep3d_ft": 545.9080027957438, "sep_h_ft": 524.9660945346642, "sep_v_ft": 149.75362134339093}, {"t": "2026-01-26T21:39:02+00:00", "rv": {"lat": 37.69418, "lon": -121.83908, "alt": 350.0, "spd": 55.0, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.694177742100685, "lon": -121.8371753632668, "alt": 191.93082873058268, "spd": 81.88659789533651, "trk": 91.46907181628258, "vs": -498.93299556158354}, "sep3d_ft": 572.0852311009529, "sep_h_ft": 549.8141947403961, "sep_v_ft": 158.06917126941732}, {"t": "2026-01-26T21:39:03+00:00", "rv": {"lat": 37.69416666666667, "lon": -121.83882666666666, "alt": 350.0, "spd": 56.333333333333336, "trk": 90.66666666666669, "vs": 0.0}, "wd": {"lat": 37.69416153355718, "lon": -121.8367049122934, "alt": 185.4184672107231, "spd": 81.30621935000396, "trk": 92.40540068238376, "vs": -390.7416911915749}, "sep3d_ft": 634.2189801451626, "sep_h_ft": 612.4921500240655, "sep_v_ft": 164.5815327892769}, {"t": "2026-01-26T21:39:04+00:00", "rv": {"lat": 37.69415333333333, "lon": -121.83857333333331, "alt": 350.0, "spd": 57.66666666666666, "trk": 91.33333333333331, "vs": 0.0}, "wd": {"lat": 37.69414268189457, "lon": -121.83623192290744, "alt": 179.65611129750363, "spd": 80.60367291855327, "trk": 93.40903844372622, "vs": -345.74135479316794}, "sep3d_ft": 697.043740830939, "sep_h_ft": 675.9089703601371, "sep_v_ft": 170.34388870249637}, {"t": "2026-01-26T21:39:05+00:00", "rv": {"lat": 37.69414, "lon": -121.83832, "alt": 350.0, "spd": 59.0, "trk": 92.0, "vs": 0.0}, "wd": {"lat": 37.69411845657747, "lon": -121.83575465895532, "alt": 172.21911390389567, "spd": 79.77751151017154, "trk": 93.84646784017438, "vs": -446.2198436164772}, "sep3d_ft": 761.6218006012862, "sep_h_ft": 740.5820168556818, "sep_v_ft": 177.78088609610433}, {"t": "2026-01-26T21:39:06+00:00", "rv": {"lat": 37.694115, "lon": -121.837875, "alt": 350.0, "spd": 61.0, "trk": 92.0, "vs": 0.0}, "wd": {"lat": 37.69409203737926, "lon": -121.83527564984264, "alt": 164.09841711374685, "spd": 78.90088229353297, "trk": 94.05273353864416, "vs": -487.2418074089296}, "sep3d_ft": 773.0890912075804, "sep_h_ft": 750.4047870479959, "sep_v_ft": 185.90158288625315}, {"t": "2026-01-26T21:39:07+00:00", "rv": {"lat": 37.69409, "lon": -121.83743, "alt": 350.0, "spd": 63.0, "trk": 92.0, "vs": 0.0}, "wd": {"lat": 37.69406783339244, "lon": -121.83482355317194, "alt": 156.75621438133533, "spd": 77.86464690668247, "trk": 93.87217647410424, "vs": -440.5321639446913}, "sep3d_ft": 776.8685037972376, "sep_h_ft": 752.4503382363025, "sep_v_ft": 193.24378561866467}, {"t": "2026-01-26T21:39:08+00:00", "rv": {"lat": 37.69409, "lon": -121.83704, "alt": 350.0, "spd": 64.5, "trk": 91.5, "vs": 0.0}, "wd": {"lat": 37.69404643514656, "lon": -121.83437071256638, "alt": 149.00435212947806, "spd": 77.2180261965593, "trk": 93.11244744839937, "vs": -465.1117351114357}, "sep3d_ft": 796.4891443237533, "sep_h_ft": 770.7111693511998, "sep_v_ft": 200.99564787052196}, {"t": "2026-01-26T21:39:09+00:00", "rv": {"lat": 37.69409, "lon": -121.83665, "alt": 350.0, "spd": 66.0, "trk": 91.0, "vs": 0.0}, "wd": {"lat": 37.69402877943152, "lon": -121.83392599959448, "alt": 141.48265651960452, "spd": 76.34952753695016, "trk": 92.44971661926316, "vs": -451.3017365924128}, "sep3d_ft": 813.8250288258224, "sep_h_ft": 786.6585631716148, "sep_v_ft": 208.51734348039548}, {"t": "2026-01-26T21:39:10+00:00", "rv": {"lat": 37.69409, "lon": -121.836315, "alt": 350.0, "spd": 67.5, "trk": 90.5, "vs": 0.0}, "wd": {"lat": 37.694016816452056, "lon": -121.83348512442448, "alt": 133.9309283605441, "spd": 75.27363534512084, "trk": 91.77413168478508, "vs": -453.103689543625}, "sep3d_ft": 845.4181728172475, "sep_h_ft": 817.3408366223464, "sep_v_ft": 216.0690716394559}, {"t": "2026-01-26T21:39:11+00:00", "rv": {"lat": 37.69409, "lon": -121.83598, "alt": 350.0, "spd": 69.0, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.69400960300948, "lon": -121.83307731633845, "alt": 126.44229749246676, "spd": 74.2474292439433, "trk": 91.39475347308446, "vs": -449.3178520846402}, "sep3d_ft": 867.7281446181403, "sep_h_ft": 838.4354993748735, "sep_v_ft": 223.55770250753324}, {"t": "2026-01-26T21:39:12+00:00", "rv": {"lat": 37.69409, "lon": -121.835575, "alt": 362.5, "spd": 70.0, "trk": 87.5, "vs": 750.0}, "wd": {"lat": 37.69400158469001, "lon": -121.83264846223628, "alt": 117.99428104085368, "spd": 73.28199645049789, "trk": 91.196999434303, "vs": -506.88098709678513}, "sep3d_ft": 880.0708176992097, "sep_h_ft": 845.423915891919, "sep_v_ft": 244.5057189591463}, {"t": "2026-01-26T21:39:13+00:00", "rv": {"lat": 37.69409, "lon": -121.83517, "alt": 375.0, "spd": 71.0, "trk": 85.0, "vs": 750.0}, "wd": {"lat": 37.69399259232182, "lon": -121.83220264255408, "alt": 109.01400168956796, "spd": 72.3345079018735, "trk": 91.03908467586425, "vs": -538.8167610771429}, "sep3d_ft": 897.6419381170958, "sep_h_ft": 857.3286987902709, "sep_v_ft": 265.985998310432}, {"t": "2026-01-26T21:39:14+00:00", "rv": {"lat": 37.694135, "lon": -121.834625, "alt": 375.0, "spd": 71.5, "trk": 83.5, "vs": 0.0}, "wd": {"lat": 37.69398780464758, "lon": -121.8317747596043, "alt": 100.88693506482858, "spd": 71.65008430007856, "trk": 90.70005630129327, "vs": -487.6239974843631}, "sep3d_ft": 868.9038691165274, "sep_h_ft": 824.533784266914, "sep_v_ft": 274.11306493517145}, {"t": "2026-01-26T21:39:15+00:00", "rv": {"lat": 37.69418, "lon": -121.83408, "alt": 375.0, "spd": 72.0, "trk": 82.0, "vs": 0.0}, "wd": {"lat": 37.693984335494335, "lon": -121.8313552329446, "alt": 91.38561841522034, "spd": 70.4286902141083, "trk": 90.44695576619728, "vs": -570.0789989764945}, "sep3d_ft": 839.1739724998008, "sep_h_ft": 789.7948079592442, "sep_v_ft": 283.61438158477966}, {"t": "2026-01-26T21:39:16+00:00", "rv": {"lat": 37.69421333333334, "lon": -121.83378, "alt": 383.3333333333333, "spd": 72.66666666666667, "trk": 82.0, "vs": 499.99999999999886}, "wd": {"lat": 37.69398353333333, "lon": -121.83095323798844, "alt": 82.22054193757589, "spd": 69.35386456106725, "trk": 90.10154588322472, "vs": -549.9045886586669}, "sep3d_ft": 873.8202490492309, "sep_h_ft": 820.3005025637343, "sep_v_ft": 301.1127913957574}, {"t": "2026-01-26T21:39:17+00:00", "rv": {"lat": 37.694246666666665, "lon": -121.83348, "alt": 391.6666666666667, "spd": 73.33333333333333, "trk": 82.0, "vs": 500.0000000000023}, "wd": {"lat": 37.693982275709466, "lon": -121.83055756622704, "alt": 73.7295483046045, "spd": 68.54787230272649, "trk": 90.2576595242607, "vs": -509.4596179782829}, "sep3d_ft": 906.6900388770912, "sep_h_ft": 849.1188464323292, "sep_v_ft": 317.93711836206217}, {"t": "2026-01-26T21:39:18+00:00", "rv": {"lat": 37.69428, "lon": -121.83318, "alt": 400.0, "spd": 74.0, "trk": 82.0, "vs": 499.99999999999886}, "wd": {"lat": 37.69398057148764, "lon": -121.83016236965616, "alt": 65.38354168052595, "spd": 67.79967735754195, "trk": 90.60681716608686, "vs": -500.7603974447133}, "sep3d_ft": 939.5325338859736, "sep_h_ft": 877.9255139543046, "sep_v_ft": 334.6164583194741}, {"t": "2026-01-26T21:39:19+00:00", "rv": {"lat": 37.694325, "lon": -121.832765, "alt": 412.5, "spd": 74.5, "trk": 82.5, "vs": 750.0}, "wd": {"lat": 37.69397521525812, "lon": -121.82978188184669, "alt": 57.9662969666463, "spd": 66.95287012349904, "trk": 91.0595165192196, "vs": -445.03468283277925}, "sep3d_ft": 939.9681298987437, "sep_h_ft": 870.5434731469757, "sep_v_ft": 354.53370303335373}, {"t": "2026-01-26T21:39:20+00:00", "rv": {"lat": 37.69437, "lon": -121.83235, "alt": 425.0, "spd": 75.0, "trk": 83.0, "vs": 750.0}, "wd": {"lat": 37.693968573231984, "lon": -121.82940983294483, "alt": 51.62640392943823, "spd": 65.93910549680193, "trk": 91.4766888594331, "vs": -380.3935822324838}, "sep3d_ft": 938.7310893178123, "sep_h_ft": 861.2828895369648, "sep_v_ft": 373.3735960705618}, {"t": "2026-01-26T21:39:21+00:00", "rv": {"lat": 37.694415, "lon": -121.83186, "alt": 425.0, "spd": 76.0, "trk": 85.0, "vs": 0.0}, "wd": {"lat": 37.693961651946125, "lon": -121.8290224214917, "alt": 44.50349470856285, "spd": 65.21247357420236, "trk": 91.177244049912, "vs": -427.3745532525231}, "sep3d_ft": 918.2043427003068, "sep_h_ft": 835.6564033229843, "sep_v_ft": 380.49650529143713}, {"t": "2026-01-26T21:39:22+00:00", "rv": {"lat": 37.69446, "lon": -121.83137, "alt": 425.0, "spd": 77.0, "trk": 87.0, "vs": 0.0}, "wd": {"lat": 37.69395459227965, "lon": -121.82862726957528, "alt": 36.87710256873593, "spd": 64.64425651837533, "trk": 90.55737089678686, "vs": -457.58352838961514}, "sep3d_ft": 900.8317844455707, "sep_h_ft": 812.9320515005861, "sep_v_ft": 388.1228974312641}, {"t": "2026-01-26T21:39:23+00:00", "rv": {"lat": 37.694465, "lon": -121.830875, "alt": 437.5, "spd": 77.5, "trk": 87.0, "vs": 750.0}, "wd": {"lat": 37.6939528, "lon": -121.82826497189708, "alt": 31.445430238596263, "spd": 63.43456700227544, "trk": 90.32897114244828, "vs": -325.90033980837995}, "sep3d_ft": 876.0518115552826, "sep_h_ft": 776.2644284682725, "sep_v_ft": 406.0545697614037}, {"t": "2026-01-26T21:39:24+00:00", "rv": {"lat": 37.69447, "lon": -121.83038, "alt": 450.0, "spd": 78.0, "trk": 87.0, "vs": 750.0}, "wd": {"lat": 37.69395029613195, "lon": -121.82789783652964, "alt": 26.6536246720951, "spd": 62.34044438219108, "trk": 90.51985182855972, "vs": -287.50833399006984}, "sep3d_ft": 853.569816926991, "sep_h_ft": 741.1877487286886, "sep_v_ft": 423.3463753279049}, {"t": "2026-01-26T21:39:25+00:00", "rv": {"lat": 37.69448, "lon": -121.82997, "alt": 458.3333333333333, "spd": 79.0, "trk": 87.66666666666667, "vs": 499.99999999999886}, "wd": {"lat": 37.69394687742504, "lon": -121.82753243414416, "alt": 22.538963625175043, "spd": 61.07318866900178, "trk": 90.89337462901555, "vs": -246.87966281520332}, "sep3d_ft": 850.2192029793046, "sep_h_ft": 730.038328066022, "sep_v_ft": 435.7943697081583}, {"t": "2026-01-26T21:39:26+00:00", "rv": {"lat": 37.69449, "lon": -121.82956, "alt": 466.6666666666667, "spd": 80.0, "trk": 88.33333333333333, "vs": 500.0000000000023}, "wd": {"lat": 37.693940889379455, "lon": -121.82718006012546, "alt": 18.560663256013537, "spd": 60.03046749309093, "trk": 91.18598121657648, "vs": -238.69802214969036}, "sep3d_ft": 844.3482314340993, "sep_h_ft": 715.6290558894481, "sep_v_ft": 448.1060034106532}, {"t": "2026-01-26T21:39:27+00:00", "rv": {"lat": 37.6945, "lon": -121.82915, "alt": 475.0, "spd": 81.0, "trk": 89.0, "vs": 499.99999999999886}, "wd": {"lat": 37.69393392206157, "lon": -121.82683143051068, "alt": 14.541559168429178, "spd": 59.11170030061645, "trk": 91.44119432613807, "vs": -241.1462452550616}, "sep3d_ft": 838.2343069961784, "sep_h_ft": 700.4389892719581, "sep_v_ft": 460.4584408315709}, {"t": "2026-01-26T21:39:28+00:00", "rv": {"lat": 37.69448, "lon": -121.82859, "alt": 487.5, "spd": 82.0, "trk": 89.5, "vs": 750.0}, "wd": {"lat": 37.6939245833037, "lon": -121.82649343440563, "alt": 11.140175736171678, "spd": 57.99463055434331, "trk": 91.57544744356149, "vs": -204.08300593545}, "sep3d_ft": 796.4064706577357, "sep_h_ft": 638.235524185896, "sep_v_ft": 476.35982426382833}, {"t": "2026-01-26T21:39:29+00:00", "rv": {"lat": 37.69446, "lon": -121.82803, "alt": 500.0, "spd": 83.0, "trk": 90.0, "vs": 750.0}, "wd": {"lat": 37.69391954010911, "lon": -121.82615703849964, "alt": 8.878975864782575, "spd": 56.81262356675785, "trk": 91.15631184358573, "vs": -135.67199228334616}, "sep3d_ft": 756.5701266950239, "sep_h_ft": 575.498476331345, "sep_v_ft": 491.1210241352175}, {"t": "2026-01-26T21:39:30+00:00", "rv": {"lat": 37.69446, "lon": -121.827505, "alt": 500.0, "spd": 85.0, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.69391356356198, "lon": -121.82583420217088, "alt": 6.656660927612307, "spd": 55.53233606223864, "trk": 90.70225728613497, "vs": -133.33889623021605}, "sep3d_ft": 718.157895436039, "sep_h_ft": 521.8841945968738, "sep_v_ft": 493.3433390723877}, {"t": "2026-01-26T21:39:31+00:00", "rv": {"lat": 37.69446, "lon": -121.82698, "alt": 500.0, "spd": 87.0, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.69390938165716, "lon": -121.82552509934236, "alt": 5.017360336467887, "spd": 54.38041131838301, "trk": 90.6, "vs": -98.35803546866521}, "sep3d_ft": 679.5199128792942, "sep_h_ft": 465.55289541705736, "sep_v_ft": 494.9826396635321}, {"t": "2026-01-26T21:39:32+00:00", "rv": {"lat": 37.694465, "lon": -121.82653, "alt": 500.0, "spd": 88.5, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.69390612303363, "lon": -121.8252189317921, "alt": 3.609274501642244, "spd": 53.28360632776751, "trk": 90.6, "vs": -84.4851500895386}, "sep3d_ft": 656.6663147713554, "sep_h_ft": 429.8917265947401, "sep_v_ft": 496.39072549835777}, {"t": "2026-01-26T21:39:33+00:00", "rv": {"lat": 37.69447, "lon": -121.82608, "alt": 500.0, "spd": 90.0, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.69390381427292, "lon": -121.82490517845748, "alt": 2.4399449525136903, "spd": 52.109164905405606, "trk": 90.39369522152616, "vs": -70.15977294771321}, "sep3d_ft": 636.5874174875107, "sep_h_ft": 397.0863026151377, "sep_v_ft": 497.5600550474863}, {"t": "2026-01-26T21:39:34+00:00", "rv": {"lat": 37.694465, "lon": -121.82548, "alt": 512.5, "spd": 91.5, "trk": 90.5, "vs": 750.0}, "wd": {"lat": 37.69390201641272, "lon": -121.82458734497474, "alt": 1.3990346895205923, "spd": 50.89296535670216, "trk": 90.07642577336586, "vs": -62.45461577958588}, "sep3d_ft": 608.1179990205754, "sep_h_ft": 329.5198081928985, "sep_v_ft": 511.1009653104794}, {"t": "2026-01-26T21:39:35+00:00", "rv": {"lat": 37.69446, "lon": -121.82488, "alt": 525.0, "spd": 93.0, "trk": 91.0, "vs": 750.0}, "wd": {"lat": 37.693901583333336, "lon": -121.82430635914552, "alt": 0.2131096300782941, "spd": 49.45982315616197, "trk": 89.6436947690598, "vs": -71.1555035665379}, "sep3d_ft": 586.7907004196119, "sep_h_ft": 262.5300855041313, "sep_v_ft": 524.7868903699217}, {"t": "2026-01-26T21:39:36+00:00", "rv": {"lat": 37.694465, "lon": -121.824165, "alt": 525.0, "spd": 94.0, "trk": 90.5, "vs": 0.0}, "wd": {"lat": 37.693901583333336, "lon": -121.82404017250644, "alt": 0.0566150958088663, "spd": 47.92389939918539, "trk": 90.17256281202536, "vs": -9.389672056165667}, "sep3d_ft": 564.8994208959774, "sep_h_ft": 208.6763004606437, "sep_v_ft": 524.9433849041911}, {"t": "2026-01-26T21:39:37+00:00", "rv": {"lat": 37.69447, "lon": -121.82345, "alt": 525.0, "spd": 95.0, "trk": 90.0, "vs": 0.0}, "wd": {"lat": 37.693901583333336, "lon": -121.82376440072616, "alt": 0.3877738696028061, "spd": 46.64987167112209, "trk": 90.8409673772746, "vs": 19.869526427636387}, "sep3d_ft": 571.3629196936147, "sep_h_ft": 226.3572357918363, "sep_v_ft": 524.6122261303972}, {"t": "2026-01-26T21:39:38+00:00", "rv": {"lat": 37.69447, "lon": -121.82307333333333, "alt": 533.3333333333334, "spd": 95.0, "trk": 89.33333333333333, "vs": 500.0000000000023}, "wd": {"lat": 37.6938979136421, "lon": -121.82348676556062, "alt": 0.9619667411392538, "spd": 45.58396258988924, "trk": 90.78518880595117, "vs": 34.45157229218686}, "sep3d_ft": 584.1406064610006, "sep_h_ft": 240.41833571794243, "sep_v_ft": 532.3713665921941}, {"t": "2026-01-26T21:39:39+00:00", "rv": {"lat": 37.69447, "lon": -121.82269666666669, "alt": 541.6666666666666, "spd": 95.0, "trk": 88.66666666666667, "vs": 499.99999999999545}, "wd": {"lat": 37.69389260403003, "lon": -121.8232107952358, "alt": 1.6417711158047732, "spd": 44.54794072509476, "trk": 90.47438224585406, "vs": 40.78826247993116}, "sep3d_ft": 598.3505860742229, "sep_h_ft": 257.67525306215714, "sep_v_ft": 540.0248955508619}, {"t": "2026-01-26T21:39:40+00:00", "rv": {"lat": 37.69447, "lon": -121.82232, "alt": 550.0, "spd": 95.0, "trk": 88.0, "vs": 500.0000000000023}, "wd": {"lat": 37.69389133333333, "lon": -121.82294701438234, "alt": 2.304357070816857, "spd": 43.157239644641486, "trk": 90.01907991203757, "vs": 39.75515730072502}, "sep3d_ft": 614.2451990895205, "sep_h_ft": 278.0766932357213, "sep_v_ft": 547.6956429291831}, {"t": "2026-01-26T21:39:41+00:00", "rv": {"lat": 37.69449, "lon": -121.82178, "alt": 562.5, "spd": 94.5, "trk": 86.5, "vs": 750.0}, "wd": {"lat": 37.69388875818682, "lon": -121.82271017796916, "alt": 2.7079072891839533, "spd": 41.21722693603197, "trk": 90.65370141743271, "vs": 24.21301310202579}, "sep3d_ft": 658.4664548761752, "sep_h_ft": 346.714414375352, "sep_v_ft": 559.7920927108161}, {"t": "2026-01-26T21:39:42+00:00", "rv": {"lat": 37.69451, "lon": -121.82124, "alt": 575.0, "spd": 94.0, "trk": 85.0, "vs": 750.0}, "wd": {"lat": 37.69388791666667, "lon": -121.82247504480722, "alt": 3.2914736196897456, "spd": 38.40138252938731, "trk": 90.21041478323356, "vs": 35.01397983034754}, "sep3d_ft": 710.9584168977057, "sep_h_ft": 422.6242201078235, "sep_v_ft": 571.7085263803102}, {"t": "2026-01-26T21:39:43+00:00", "rv": {"lat": 37.69458, "lon": -121.820735, "alt": 600.0, "spd": 91.0, "trk": 77.5, "vs": 1500.0}, "wd": {"lat": 37.69388791666667, "lon": -121.8222664858421, "alt": 3.691888236077744, "spd": 35.21551129159725, "trk": 89.62356232821759, "vs": 24.02487698327991}, "sep3d_ft": 784.0779609500454, "sep_h_ft": 509.1118587227433, "sep_v_ft": 596.3081117639223}, {"t": "2026-01-26T21:39:44+00:00", "rv": {"lat": 37.69465, "lon": -121.82023, "alt": 625.0, "spd": 88.0, "trk": 70.0, "vs": 1500.0}, "wd": {"lat": 37.69388791666667, "lon": -121.82207275720585, "alt": 4.26390919718849, "spd": 31.781308274836903, "trk": 89.72445928495455, "vs": 34.321257666644776}, "sep3d_ft": 863.4686183934217, "sep_h_ft": 600.2205932197663, "sep_v_ft": 620.7360908028115}, {"t": "2026-01-26T21:39:45+00:00", "rv": {"lat": 37.694895, "lon": -121.819635, "alt": 662.5, "spd": 86.5, "trk": 62.5, "vs": 2250.0}, "wd": {"lat": 37.69388791666667, "lon": -121.82189389550643, "alt": 4.670609513037667, "spd": 28.25033587546473, "trk": 90.6096195753125, "vs": 24.402018950950612}, "sep3d_ft": 996.4552305573096, "sep_h_ft": 748.454086445236, "sep_v_ft": 657.8293904869623}, {"t": "2026-01-26T21:39:46+00:00", "rv": {"lat": 37.69514, "lon": -121.81904, "alt": 700.0, "spd": 85.0, "trk": 55.0, "vs": 2250.0}, "wd": {"lat": 37.69388537499668, "lon": -121.82173523278036, "alt": 5.001280647543818, "spd": 25.440241411796173, "trk": 91.71829375508476, "vs": 19.84026807036905}, "sep3d_ft": 1139.2320681413296, "sep_h_ft": 902.6773981772318, "sep_v_ft": 694.9987193524562}, {"t": "2026-01-26T21:39:47+00:00", "rv": {"lat": 37.695335, "lon": -121.8188, "alt": 725.0, "spd": 83.5, "trk": 46.5, "vs": 1500.0}, "wd": {"lat": 37.69388196398731, "lon": -121.8216055030264, "alt": 5.328821396354035, "spd": 22.350582819541057, "trk": 92.29689904643482, "vs": 19.65244492861304}, "sep3d_ft": 1206.1491766216516, "sep_h_ft": 967.9200540087631, "sep_v_ft": 719.671178603646}, {"t": "2026-01-26T21:39:48+00:00", "rv": {"lat": 37.69553, "lon": -121.81856, "alt": 750.0, "spd": 82.0, "trk": 38.0, "vs": 1500.0}, "wd": {"lat": 37.69387857182115, "lon": -121.82148343898214, "alt": 5.413385826771673, "spd": 19.58880044823347, "trk": 92.25298465305782, "vs": 5.07386582505827}, "sep3d_ft": 1276.5373885889449, "sep_h_ft": 1036.888845759048, "sep_v_ft": 744.5866141732283}];
const cpaTime = "2026-01-26T21:38:48+00:00";

const map = L.map('map', { zoomControl: true }).setView([37.69576868960072, -121.84081667154877], 15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

function fmt0(x) {
  if (x === null || x === undefined || isNaN(x)) return 'â€”';
  return Math.round(x).toString();
}
function fmtSign0(x) {
  if (x === null || x === undefined || isNaN(x)) return 'â€”';
  const v = Math.round(x);
  return (v>0?'+':'') + v.toString();
}

function planeIcon(color) {
  // SAME style as prior (triangle), only slightly larger
  const svg = `
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 26 26">
    <g>
      <path d="M13 2 L22 22 L13 18 L4 22 Z" fill="${color}" stroke="rgba(0,0,0,0.6)" stroke-width="1"/>
    </g>
  </svg>`;
  return L.divIcon({
    html: svg,
    className: '',
    iconSize: [32,32],
    iconAnchor: [16,16]
  });
}

function calloutIcon(html) {
  return L.divIcon({
    html: `<div class="callout">${html}</div>`,
    className: '',
    iconSize: null
  });
}

function calloutIconBottomLeft(html) {
  return L.divIcon({
    html: `<div class="callout">${html}</div>`,
    className: '',
    iconSize: [120, 80],  // approximate size
    iconAnchor: [0, 80]   // bottom-left anchor
  });
}

// Plane markers
const rvMarker = L.marker([frames[0].rv.lat, frames[0].rv.lon], {icon: planeIcon('#ff3b30')}).addTo(map);
const wdMarker = L.marker([frames[0].wd.lat, frames[0].wd.lon], {icon: planeIcon('#0a84ff')}).addTo(map);


// 2px position dots (current aircraft position)
const rvDot = L.circleMarker([frames[0].rv.lat, frames[0].rv.lon], {
  radius: 5, color: '#ffffff', weight: 2, fillColor: '#000000', fillOpacity: 1
}).addTo(map);
const wdDot = L.circleMarker([frames[0].wd.lat, frames[0].wd.lon], {
  radius: 5, color: '#ffffff', weight: 2, fillColor: '#000000', fillOpacity: 1
}).addTo(map);

// Callout leader anchor tuning (approx, in pixels)
const RV_CALLOUT_W = 150;   // approx width of callout box
const RV_CALLOUT_H = 55;    // approx height of callout box

// Callout markers
let rvCallout = L.marker([frames[0].rv.lat, frames[0].rv.lon], {icon: calloutIcon('')}).addTo(map);
let wdCallout = L.marker([frames[0].wd.lat, frames[0].wd.lon], {icon: calloutIcon('')}).addTo(map);

// Leader lines (UNCHANGED styling)
let rvLeader = L.polyline([[frames[0].rv.lat, frames[0].rv.lon],[frames[0].rv.lat, frames[0].rv.lon]], {
  color: '#ff3b30', weight: 2, opacity: 0.8, dashArray: '4 6'
}).addTo(map);
let wdLeader = L.polyline([[frames[0].wd.lat, frames[0].wd.lon],[frames[0].wd.lat, frames[0].wd.lon]], {
  color: '#0a84ff', weight: 2, opacity: 0.8, dashArray: '4 6'
}).addTo(map);

// Tracks (UNCHANGED)
const rvLatLngs = frames.map(f => [f.rv.lat, f.rv.lon]);
const wdLatLngs = frames.map(f => [f.wd.lat, f.wd.lon]);
const rvLine = L.polyline(rvLatLngs, {color:'#ff3b30', weight:3, opacity:0.75}).addTo(map);
const wdLine = L.polyline(wdLatLngs, {color:'#0a84ff', weight:3, opacity:0.75}).addTo(map);
map.fitBounds(L.featureGroup([rvLine, wdLine]).getBounds().pad(0.25));

// CPA marker midpoint (UNCHANGED)
const cpaIdx = frames.findIndex(f => f.t === cpaTime);
if (cpaIdx >= 0) {
  const f = frames[cpaIdx];
  const mid = [(f.rv.lat + f.wd.lat)/2, (f.rv.lon + f.wd.lon)/2];
  L.circleMarker(mid, {radius: 8, color:'#ffd60a', weight:3, fillOpacity:0.2})
    .bindTooltip(`<b>CPA</b><br>${cpaTime}`, {sticky:true})
    .addTo(map);
}

function setMarkerHeading(marker, deg) {
  const el = marker.getElement();
  if (!el) return;
  const rot = (deg === null || deg === undefined || isNaN(deg)) ? 0 : deg;
  el.style.transformOrigin = "center";
  el.style.transform = `rotate(${rot}deg)`;
}

// Pixel-offset helper (same as before)
function offsetLatLng(lat, lon, dx, dy) {
  const lp = map.latLngToLayerPoint([lat, lon]);
  const lp2 = L.point(lp.x + dx, lp.y + dy);
  const ll2 = map.layerPointToLatLng(lp2);
  return [ll2.lat, ll2.lng];
}


// NEW: compute leader attachment point at bottom-center of a divIcon callout
function calloutBottomCenterLatLng(calloutMarker, fallbackLatLng) {
  const el = calloutMarker.getElement && calloutMarker.getElement();
  if (!el) return fallbackLatLng;
  const pos = L.DomUtil.getPosition(el); // top-left in layer coords
  const w = el.offsetWidth || 0;
  const h = el.offsetHeight || 0;
  const pt = L.point(pos.x + w/2, pos.y + h); // bottom-center
  const ll = map.layerPointToLatLng(pt);
  return [ll.lat, ll.lng];
}

// NEW: forward nudge along current track, in screen pixels
function forwardOffsetPx(lat, lon, trkDeg, px) {
  if (trkDeg === null || trkDeg === undefined || isNaN(trkDeg)) return [0,0];
  // track is degrees clockwise from north
  const rad = trkDeg * Math.PI / 180.0;
  // screen coords: +x right (east), +y down (south)
  const dx = Math.sin(rad) * px;
  const dy = -Math.cos(rad) * px;
  return [dx, dy];
}

const audioPlayer = document.getElementById('audioPlayer');

// Wait for audio to load
audioPlayer.addEventListener('loadedmetadata', () => {
  console.log('Audio loaded, duration:', audioPlayer.duration);
});

audioPlayer.addEventListener('error', (e) => {
  console.error('Audio load error:', e);
});

const scrub = document.getElementById('scrub');
const tLbl = document.getElementById('tLbl');
const sepLbl = document.getElementById('sepLbl');
const fLbl = document.getElementById('fLbl');
const speed = document.getElementById('speed');
const spdLbl = document.getElementById('spdLbl');

let i = 0;
let timer = null;
let rate = 1.0;
let baseIntervalMs = 1000; // 1 second per frame for 1x speed (120 frames = 120 seconds)

function render(idx) {
  i = Math.max(0, Math.min(frames.length-1, idx));
  const f = frames[i];

  rvMarker.setLatLng([f.rv.lat, f.rv.lon]);
  wdMarker.setLatLng([f.wd.lat, f.wd.lon]);

  // Update position dots
  rvDot.setLatLng([f.rv.lat, f.rv.lon]);
  wdDot.setLatLng([f.wd.lat, f.wd.lon]);

  setMarkerHeading(rvMarker, f.rv.trk);
  setMarkerHeading(wdMarker, f.wd.trk);

  // Updated: place RV callout relative to aircraft in screen pixels
  // RV callout with BOTTOM-LEFT anchor: symmetric to WD (mirrored NNE vs SSE)
  const rvC = offsetLatLng(f.rv.lat, f.rv.lon, 50, -65);

  // Keep WD behavior as before (forward nudge + vertical offset)
  const wdF = forwardOffsetPx(f.wd.lat, f.wd.lon, f.wd.trk, 26);
  const wdC = offsetLatLng(f.wd.lat, f.wd.lon, wdF[0], wdF[1] + 55);

  rvCallout.setLatLng(rvC);
  wdCallout.setLatLng(wdC);

rvCallout.setIcon(calloutIconBottomLeft(
    `<b>N748PK</b><br>` +
    `Alt: ${fmt0(f.rv.alt)} ft<br>` +
    `GS: ${f.rv.spd===null ? 'â€”' : fmt0(f.rv.spd)} kts<br>` +
    `VS: ${f.rv.vs===null ? 'â€”' : fmtSign0(f.rv.vs)} fpm`
  ));
  wdCallout.setIcon(calloutIcon(
    `<b>N89WD</b><br>` +
    `Alt: ${fmt0(f.wd.alt)} ft<br>` +
    `GS: ${f.wd.spd===null ? 'â€”' : fmt0(f.wd.spd)} kts<br>` +
    `VS: ${f.wd.vs===null ? 'â€”' : fmtSign0(f.wd.vs)} fpm`
  ));

  // RV leader: attach to bottom-left anchor of the RV callout
  // With bottom-left anchor, rvC IS the connection point
  rvLeader.setLatLngs([[f.rv.lat, f.rv.lon], [rvC[0], rvC[1]]]);

  // WD leader unchanged
  wdLeader.setLatLngs([[f.wd.lat, f.wd.lon], wdC]);

tLbl.textContent = f.t;
  sepLbl.textContent = `${fmt0(f.sep3d_ft)} ft  (H ${fmt0(f.sep_h_ft)} / V ${fmt0(f.sep_v_ft)})`;
  scrub.value = i;
  fLbl.textContent = i;
}

function stop() {
  if (timer) {
    clearInterval(timer);
    timer = null;
  }
  audioPlayer.pause();
}

function play() {
  stop();
  
  // Calculate audio time based on current frame
  const totalFrames = frames.length;
  const audioDuration = audioPlayer.duration;
  
  if (audioDuration && !isNaN(audioDuration)) {
    const frameTime = (i / totalFrames) * audioDuration;
    audioPlayer.currentTime = frameTime;
    console.log('Syncing audio to frame', i, 'at time', frameTime.toFixed(2), 's');
  }
  
  audioPlayer.playbackRate = rate;
  
  // Start audio
  audioPlayer.play().catch(err => {
    console.warn('Audio play failed:', err);
  });
  
  // Start animation
  const interval = baseIntervalMs / rate;
  timer = setInterval(() => {
    if (i >= frames.length - 1) { 
      stop(); 
      return; 
    }
    render(i + 1);
  }, interval);
}

document.getElementById('playBtn').onclick = play;
document.getElementById('pauseBtn').onclick = stop;
document.getElementById('stepBtn').onclick = () => { stop(); render(i+1); };

// Mute button
let isMuted = false;
const muteBtn = document.getElementById('muteBtn');
muteBtn.onclick = () => {
  isMuted = !isMuted;
  audioPlayer.muted = isMuted;
  muteBtn.textContent = isMuted ? 'ðŸ”‡ Unmute' : 'ðŸ”Š Mute';
};

scrub.oninput = () => { 
  stop(); 
  const newFrame = parseInt(scrub.value, 10);
  render(newFrame);
  
  // Sync audio to scrubbed position
  const totalFrames = frames.length;
  const audioDuration = audioPlayer.duration;
  
  if (audioDuration && !isNaN(audioDuration)) {
    const frameTime = (newFrame / totalFrames) * audioDuration;
    audioPlayer.currentTime = frameTime;
    console.log('Scrubbed to frame', newFrame, '/', totalFrames, '- audio at', frameTime.toFixed(2), 's');
  }
};
speed.oninput = () => {
  rate = parseFloat(speed.value);
  spdLbl.textContent = rate.toFixed(2) + "Ã—";
  audioPlayer.playbackRate = rate; // Update audio speed in real-time
  if (timer) play();
};

map.on('zoomend move', () => render(i));

render(0);
</script>
</body>
</html>
